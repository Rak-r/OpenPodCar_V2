<?xml version="1.0" ?>
<!-- =================================================================================== -->
<!-- |    This document was autogenerated by xacro from podcar.urdf.xacro              | -->
<!-- |    EDITING THIS FILE BY HAND IS NOT RECOMMENDED                                 | -->
<!-- =================================================================================== -->
<robot name="podcar" xmlns:xacro="http://www.ros.org/wiki/xacro">
  <!--<origin xyz="0 0 0.3" rpy="0 0 0"/> -->
  <!-- <link name="base_footprint"/>
  
  <joint name="chassis_joint" type="fixed">
    <origin xyz="0 0 0.238145" rpy="0 0 0" />
    <parent link="base_footprint" />
    <child link="base_link" />
  </joint> -->

  <link name="base_link">
    <inertial>
      <mass value="33.855"/>
      <origin rpy=" 0 0 0" xyz="-0.0856132 -0.000839955 0.238145"/>
      <inertia ixx="2.2343" ixy="-0.023642" ixz="0.275174" iyy="3.42518" iyz="0.00239624" izz="2.1241"/>
    </inertial>
    <collision>
      <origin rpy=" 0 0 0" xyz="0 0 0.25"/>
      <geometry>
        <box size="1.6 0.73 0.1"/>
      </geometry>
    </collision>
    <visual>
      <origin rpy="0 0 1.57" xyz="0 0 0"/>
      <geometry>
        <mesh filename="file://$(find pod2_description)/meshes/podcarv3.dae" scale="1 1 1"/>
        <!-- <scale>65 69 69</scale> -->
      </geometry>
      <material name="blue">
        <color rgba="0 0.50 0.95 1"/>
      </material> 
    </visual>
  </link>
 
  <gazebo reference="base_link">
    <dampingFactor>1</dampingFactor>
    <material>Gazebo/Blue</material>
  </gazebo>
  <gazebo reference="front_left_wheel">
    <mu1 value="1.0"/>
    <mu2 value="0.25"/>
    <!-- <slip1 value="0.01"/>
    <slip2 value="0.001"/> -->
    <fdir1>0 0 1</fdir1>
    <material>Gazebo/Black</material>
  </gazebo>
  <gazebo reference="front_right_wheel">
    <mu1 value="1.0"/>
    <mu2 value="0.25"/>
    <fdir1>0 0 1</fdir1>
    <!-- <slip1 value="0.01"/>
    <slip2 value="0.001"/> -->
    <material>Gazebo/Black</material>
  </gazebo>
  <gazebo reference="back_left_wheel">
    <mu1 value="10"/>
    <mu2 value="1.0"/>
    <!-- <fdir1>0 0 1</fdir1> -->
    <!-- <slip1 value="0.0"/>
    <slip2 value="0.0"/> -->
    <material>Gazebo/Black</material>
  </gazebo>
  <gazebo reference="back_right_wheel">
    <mu1 value="10"/>
    <mu2 value="1.0"/>
    <!-- <fdir1>0 0 1</fdir1> -->
    <!-- <slip1 value="0.0"/>
    <slip2 value="0.0"/> -->
    <material>Gazebo/Black</material>
  </gazebo>

  <link name="front_left_wheel">
    <!-- <origin xyz="0.6 0.285475 0.0" rpy="0 0 0"/> -->
    <inertial>
      <mass value="2.6357"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.0246688" ixy="0.0" ixz="0.0" iyy="0.0246688" iyz="0.0" izz="0.0441058"/>
    </inertial>
    <collision>
      <!-- <origin xyz="0 0 0" rpy="-1.5707 0 0"/> -->
      <geometry>
        <cylinder length="0.1143" radius="0.17775"/>
      </geometry>
    </collision>
    <visual>
      <!-- <origin xyz="0 0 0" rpy="-3.14159 0 0"/> -->
      <geometry>
        <cylinder length="0.1143" radius="0.17775"/>
      </geometry>
      <material name="black">
        <color rgba="0 0.0 0.0 1"/>
      </material>
    </visual>
  </link>

  
  <link name="front_right_wheel">
    <!-- <origin xyz="0.6 -0.285475 0.0" rpy="0 0 0"/> -->
    <inertial>
      <mass value="2.6357"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.0246688" ixy="0.0" ixz="0.0" iyy="0.0246688" iyz="0.0" izz="0.0441058"/>
    </inertial>
    <collision >
      <!-- <origin xyz="0 0 0" rpy="-1.5707 0 0"/> -->
      <geometry>
        <cylinder length="0.1143" radius="0.17775"/>
      </geometry>
    </collision>
    <visual>
      <!-- <origin xyz="0 0 0" rpy="-3.14159 0 0"/> -->
      <geometry>
        <cylinder length="0.1143" radius="0.17775"/>
      </geometry>
      <material name="black">
        <color rgba="0 0.0 0.0 1"/>
      </material> 
    </visual>
  </link>
  <link name="back_left_wheel">
    <!-- <origin xyz="-0.6 0.285475 0.0" rpy="0 0 0"/>  -->
    <inertial>
      <mass value="2.6357"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="0.0246688" ixy="0.0" ixz="0.0" iyy="0.0246688" iyz="0.0" izz="0.0441058"/>
    </inertial>
    <collision>
      <!-- <origin xyz="0 0 0" rpy="-1.5707 0 0"/> -->
      <geometry>
        <cylinder length="0.1143" radius="0.17775"/>
      </geometry>
    </collision>
    <visual>
      <!-- <origin xyz="0 0 0" rpy="-3.14159 0 0"/> -->
      <geometry>
        <cylinder length="0.1143" radius="0.17775"/>
      </geometry>
      <material name="black">
        <color rgba="0 0.0 0.0 1"/>
      </material> 
    </visual>
  </link>
  <link name="back_right_wheel">
    <!-- <origin xyz="-0.6 -0.285475 0.0" rpy="0 0 0"/> -->
    <inertial>
      <mass value="2.6357"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertia ixx="0.0246688" ixy="0.0" ixz="0.0" iyy="0.0246688" iyz="0.0" izz="0.0441058"/>
    </inertial>
    <collision>
      <!-- <origin xyz="0 0 0" rpy="-1.5707 0 0"/> -->
      <geometry>
        <cylinder length="0.1143" radius="0.17775"/>
      </geometry>
    </collision>
    <visual>
      <!-- <origin xyz="0 0 0" rpy="-3.14159 0 0"/> -->
      <geometry>
        <cylinder length="0.1143" radius="0.17775"/>
      </geometry>
      <material name="black">
        <color rgba="0 0.0 0.0 1"/>
      </material> 
    </visual>
  </link>
  <!--Pivot links of the wheels with tracking rod as the parent link --> 
  <link name="front_left_wheel_steer">
    <origin xyz="0.6 0.285475 0.0" rpy="0 0 0"/>
    <inertial>
      <mass value="2.637"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="5.1458e-5" iyy="5.1458e-5" izz="6.125e-5"
               ixy="0" ixz="0" iyz="0"/>
    </inertial>
    <visual>
      <geometry>
        <cylinder length="0.01" radius="0.01"/>
      </geometry>
      <material name="black">
        <color rgba="0 0 0 1"/>
      </material>
    </visual>
    <collision>
      <geometry>
        <cylinder length="0.01" radius="0.01"/>
      </geometry>
    </collision>
  </link>
  <link name="front_right_wheel_steer">
    <origin xyz="0.6 -0.285475 0.0" rpy="0 0 0"/>
    <inertial>
      <mass value="2.637"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="5.1458e-5" iyy="5.1458e-5" izz="6.125e-5"
               ixy="0" ixz="0" iyz="0"/>
    </inertial>
    <visual>
      <geometry>
        <cylinder length="0.01" radius="0.01"/>
      </geometry>
      <material name="black">
        <color rgba="0 0 0 1"/>
      </material>
    </visual>
    <collision>
      <geometry>
        <cylinder length="0.01" radius="0.01"/>
      </geometry>
    </collision>
  </link>

  <joint name="back_left_wheel_joint" type="continuous">
    <origin rpy="-1.57 0 0" xyz="-0.6 0.285475 -0.045" />
    <parent link="base_link" />
    <child link="back_left_wheel" />
    <axis xyz="0 0 1" />
    <dynamics damping="0.0" friction="1"/>
    <!-- <limit effort="10000" lower="-0.82393858467" upper="0.82393858467" velocity="30"/> -->
  </joint>
 

  <joint name="back_right_wheel_joint" type="continuous">
    <origin rpy="-1.57 0 0" xyz="-0.6 -0.285475 -0.045" />
    <parent link="base_link" />
    <child link="back_right_wheel" />
    <axis xyz="0 0 1" />
    <dynamics damping="0.0" friction="1"/>
    <!-- <limit effort="10000" lower="-0.82393858467" upper="0.82393858467" velocity="30"/> -->
  </joint>

  <joint name="front_left_wheel_steer_joint" type="revolute">
   <origin rpy="0 0 0" xyz="0.6 0.285475 -0.045"/>
    <parent link="base_link" />
    <child link="front_left_wheel_steer" />
    <axis xyz="0 0 1" />
    <!-- <dynamics damping="0.0" friction="1"/> -->
    <limit effort="25" lower="-0.82393858467" upper="0.82393858467" velocity="1.0"/>
  </joint>
  <joint name="front_left_wheel_joint" type="continuous">
    <axis xyz="0 0 1"/>
    <parent link="front_left_wheel_steer"/>
    <child link="front_left_wheel"/>
    <origin rpy="-1.57 0 0" xyz="0 0 0"/>
    <dynamics damping="0.0" friction="1"/>
    <!-- <limit effort="10" lower="-0.82393858467" upper="0.82393858467" velocity="2.0"/> -->
  </joint>
  <joint name="front_right_wheel_steer_joint" type="revolute">
   <origin rpy="0 0 0" xyz="0.6 -0.285475 -0.045"/>
    <parent link="base_link" />
    <child link="front_right_wheel_steer" />
    <axis xyz="0 0 1" />
    <!-- <dynamics damping="0.0" friction="1"/> -->
    <limit effort="25" lower="-0.82393858467" upper="0.82393858467" velocity="1.0"/>
  </joint>
  <joint name="front_right_wheel_joint" type="continuous">
    <axis xyz="0 0 1"/>
    <parent link="front_right_wheel_steer"/>
    <child link="front_right_wheel"/>
    <origin rpy="-1.57 0 0" xyz="0 0 0"/>
    <dynamics damping="0.0" friction="1"/>
    <!-- <limit effort="10" lower="-0.82393858467" upper="0.82393858467" velocity="1.0"/> -->
  </joint>

 <!-- The optical flow sensor is mounted on the podcar, and has been tested for odometry estimation for translational movements.
      This is solely for physical vehicle not simualtion but can be viewed in sim and rviz2 as well -->

  <!-- optical flow sensor mounted on base link-->
  <joint name="optical_flow_joint" type="fixed">
    <origin rpy="0 0 0" xyz="+0.0 +0.4 0.155"/>
    <parent link="base_link"/>
    <child link="optical_flow_link"/>
  </joint>
  <link name="optical_flow_link">
    <inertial>
      <mass value="0.01"/>
      <origin xyz="0 0 0"/>
      <inertia ixx="1e-7" ixy="0" ixz="0" iyy="1e-7" iyz="0" izz="1e-7"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0"/>
      <geometry>
        <box size="0.01 0.02 0.02"/>
      </geometry>
    </visual>
  </link> 
  
  <link name="camera_link">
    <inertial>
      <mass value="0.01"/>
      <origin xyz="0 0 0" rpy="0.0 0. 0.0"/>
      <inertia ixx="1e-7" ixy="0" ixz="0" iyy="1e-7" iyz="0" izz="1e-7"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0"/>
      <geometry>
        <box size="0.01 0.02 0.02"/>
      </geometry>
    </visual>
  </link> 
  

  <!-- The below joint is for Game theory experiment to just see the right side tilted -60 degrees (in ROS cordinates) becuause of limited FOV of the camera
  This camera setup is mounted at approximately 4.5 cm behind the original camera joint setup -->
  
  <joint name="camera_joint" type="fixed">
    <origin rpy="0 0 -1.0471975511965976" xyz="+0.8 0 0.68"/>                           
    <parent link="base_link"/>
    <child link="camera_link"/>
  </joint>
  
  <gazebo reference="camera_link">
    <sensor name="rgbd" type="rgbd_camera">
      <gz_frame_id>camera_link</gz_frame_id>
      <pose>0. 0. 0. 0. 0. 0.</pose>
      <topic>rgbd_camera</topic>
      <always_on>true</always_on>
      <visualize>true</visualize>
      <update_rate>20</update_rate>
      <camera>
        <horizontal_fov>1.21</horizontal_fov>
        <image>
          <width>640</width>
          <height>480</height>
          <format>R_FLOAT32</format>
        </image>
        <clip>
          <near>0.3</near>
          <far>10.0</far>
        </clip>
      </camera>
      <plugin filename="ignition-gazebo-sensors-system" name="ignition::gazebo::systems::Sensors">
        <render_engine>ogre2</render_engine>
      </plugin>
    </sensor>
  </gazebo> 
  
  <gazebo>
    <plugin
       filename="ignition-gazebo-ackermann-steering-system"
      name="gz::sim::systems::AckermannSteering">
      <left_joint>front_left_wheel_joint</left_joint>
      <left_joint>back_left_wheel_joint</left_joint>
      <right_joint>front_right_wheel_joint</right_joint>
      <right_joint>back_right_wheel_joint</right_joint>
      <left_steering_joint>front_left_wheel_steer_joint</left_steering_joint>
      <right_steering_joint>front_right_wheel_steer_joint</right_steering_joint>
      <kingpin_width>1.0</kingpin_width>
      <steering_limit>0.8</steering_limit>
      <wheel_base>1.6</wheel_base>
      <wheel_separation>0.70</wheel_separation>
      <wheel_radius>0.17775</wheel_radius>
      <min_velocity>-5</min_velocity>
      <max_velocity>30</max_velocity>
      <min_acceleration>-3</min_acceleration>
      <max_acceleration>3</max_acceleration>
      <odom_topic>/ackermann_odom</odom_topic>
      <tf_topic>/ackermann_tf</tf_topic>
      <!-- <odom_publish_frequency>20</odom_publish_frequency>
      <frame_id>odom</frame_id>
      <child_frame_id>base_link</child_frame_id> -->
    </plugin>
  </gazebo>
  <gazebo>
    <plugin
      filename="ignition-gazebo-odometry-publisher-system"
      name="ignition::gazebo::systems::OdometryPublisher">
      <xyz_offset>0 0 0</xyz_offset>
      <rpy_offset>0 0 0</rpy_offset>
      <gaussian_noise>0</gaussian_noise>
      <robot_base_frame>base_link</robot_base_frame>
      <dimensions>3</dimensions>
      <odom_publish_frequency>20</odom_publish_frequency>
      <odom_frame>odom</odom_frame>
    </plugin>
  </gazebo>
</robot>

